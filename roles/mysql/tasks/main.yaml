  - name: Install MySQL Server package
    apt:
      name: mysql-server
      state: present
    become: yes

  - name: Ensure MySQL service is started and enabled
    service:
      name: mysql
      state: started
      enabled: yes
  
  
  - name: Install PyMySQL package
    apt:
      name: python3-pymysql
      state: present

  - name: Create override.cnf file
    template:
      src: mysql_override.cnf.j2
      dest: /etc/mysql/mysql.conf.d/override.cnf
      owner: mysql
      group: mysql
    notify: Restart Mysql
    

  - name: MySQL database
    community.mysql.mysql_db:
      name: "{{ mysql_database }}"
      login_unix_socket: /var/run/mysqld/mysqld.sock

  
  - name: MySQL user
    community.mysql.mysql_user:
      name: "{{ mysql_user }}"
      password: "{{ mysql_password }}"
      host: "%"
      priv: "{{ mysql_database }}.*:ALL"
      login_unix_socket: /var/run/mysqld/mysqld.sock

