K 20 dets  2023 12:21:51 EET
cheba-Aspire-A315-43
[WARNING]: Collection community.general does not support Ansible version 2.10.8

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-3]
ok: [cheburara-1]

TASK [init : Update APT cache] *************************************************
changed: [cheburara-3]
changed: [cheburara-1]
changed: [cheburara-2]

TASK [init : Install Prometheus Node Exporter] *********************************
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 265 not upgraded.
changed: [cheburara-3]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 265 not upgraded.
changed: [cheburara-1]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 265 not upgraded.
changed: [cheburara-2]

TASK [init : Start and Enable Node Exporter Service] ***************************
ok: [cheburara-2]
ok: [cheburara-3]
ok: [cheburara-1]

TASK [init : Install up-to-date CA certificates] *******************************
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 264 not upgraded.
changed: [cheburara-2]
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 264 not upgraded.
changed: [cheburara-1]
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 264 not upgraded.
changed: [cheburara-3]

TASK [init : Install rsyslog] **************************************************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Create a custom rsyslog configuration file] ***********************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp76276vjg/rsyslog.conf.j2
@@ -0,0 +1,9 @@
+$WorkDirectory /var/spool/rsyslog  
+$ActionQueueType LinkedList  
+$ActionQueueFileName srvrfwd  
+$ActionResumeRetryCount -1  
+$ActionQueueSaveOnShutdown on  
+$ModLoad imudp #loads the udp module  
+$UDPServerAddress localhost 
+$UDPServerRun 514 
+*.*@@localhost:6514;RSYSLOG_SyslogProtocol23Format

changed: [cheburara-2]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpqs7ikol3/rsyslog.conf.j2
@@ -0,0 +1,9 @@
+$WorkDirectory /var/spool/rsyslog  
+$ActionQueueType LinkedList  
+$ActionQueueFileName srvrfwd  
+$ActionResumeRetryCount -1  
+$ActionQueueSaveOnShutdown on  
+$ModLoad imudp #loads the udp module  
+$UDPServerAddress localhost 
+$UDPServerRun 514 
+*.*@@localhost:6514;RSYSLOG_SyslogProtocol23Format

changed: [cheburara-1]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp7vl_grgz/rsyslog.conf.j2
@@ -0,0 +1,9 @@
+$WorkDirectory /var/spool/rsyslog  
+$ActionQueueType LinkedList  
+$ActionQueueFileName srvrfwd  
+$ActionResumeRetryCount -1  
+$ActionQueueSaveOnShutdown on  
+$ModLoad imudp #loads the udp module  
+$UDPServerAddress localhost 
+$UDPServerRun 514 
+*.*@@localhost:6514;RSYSLOG_SyslogProtocol23Format

changed: [cheburara-3]

TASK [init : Modify a custom rsyslog configuration file] ***********************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpix55slro/rsyslog.confadvanced.j2
@@ -0,0 +1 @@
+action(type="omfwd" Protocol="udp" Target="influxdb" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")

changed: [cheburara-2]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp1cs1w_k_/rsyslog.confadvanced.j2
@@ -0,0 +1 @@
+action(type="omfwd" Protocol="udp" Target="influxdb" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")

changed: [cheburara-1]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp8xlnfmwl/rsyslog.confadvanced.j2
@@ -0,0 +1 @@
+action(type="omfwd" Protocol="udp" Target="influxdb" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")

changed: [cheburara-3]

TASK [init : Ensure the user 'backup' exists with a unique SSH key] ************
changed: [cheburara-3]
changed: [cheburara-1]
changed: [cheburara-2]

TASK [init : Create known_hosts file for user backup] **************************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp90554j5x/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.chebariss.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [cheburara-1]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpbyo82jf9/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.chebariss.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [cheburara-3]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmport3eya_/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.chebariss.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [cheburara-2]

TASK [init : Ensure /home/backup/restore directory exists] *********************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-1]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-3]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-2]

TASK [init : Ensure Duplicity is installed] ************************************
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 264 not upgraded.
changed: [cheburara-3]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 264 not upgraded.
changed: [cheburara-2]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 264 not upgraded.
changed: [cheburara-1]

RUNNING HANDLER [init : Restart rsyslog] ***************************************
changed: [cheburara-1]
changed: [cheburara-2]
changed: [cheburara-3]

PLAY [DNS server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-1]
ok: [cheburara-3]
ok: [cheburara-2]

TASK [bind : Install Bind9 package] ********************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]

TASK [bind : Create configuration bind9 file] **********************************
changed: [cheburara-1]
changed: [cheburara-3]
changed: [cheburara-2]

TASK [bind : Create configuration bind9 for master and slave] ******************
changed: [cheburara-3]
changed: [cheburara-1]
changed: [cheburara-2]

TASK [bind : Create DNS Zone File if not existing] *****************************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpf0vvaxno/dns_zone.j2
@@ -0,0 +1,21 @@
+; BIND data file for chebariss.io zone
+;
+$TTL    604800
+chebariss.io.       IN      SOA     chebariss.io. admin.chebariss.io. (
+                             3         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+
+; NS records for each DNS server
+chebariss.io.  IN  NS   cheburara-3.chebariss.io.
+chebariss.io.  IN  NS   cheburara-1.chebariss.io.
+chebariss.io.  IN  NS   cheburara-2.chebariss.io.
+
+; A records for each NS record
+cheburara-3  IN  A   192.168.43.96
+cheburara-1  IN  A   192.168.43.197
+cheburara-2  IN  A   192.168.43.24
+
+

changed: [cheburara-3]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpc0p6vgl3/dns_zone.j2
@@ -0,0 +1,21 @@
+; BIND data file for chebariss.io zone
+;
+$TTL    604800
+chebariss.io.       IN      SOA     chebariss.io. admin.chebariss.io. (
+                             3         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+
+; NS records for each DNS server
+chebariss.io.  IN  NS   cheburara-3.chebariss.io.
+chebariss.io.  IN  NS   cheburara-1.chebariss.io.
+chebariss.io.  IN  NS   cheburara-2.chebariss.io.
+
+; A records for each NS record
+cheburara-3  IN  A   192.168.43.96
+cheburara-1  IN  A   192.168.43.197
+cheburara-2  IN  A   192.168.43.24
+
+

changed: [cheburara-1]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmplt4obb37/dns_zone.j2
@@ -0,0 +1,21 @@
+; BIND data file for chebariss.io zone
+;
+$TTL    604800
+chebariss.io.       IN      SOA     chebariss.io. admin.chebariss.io. (
+                             3         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+
+; NS records for each DNS server
+chebariss.io.  IN  NS   cheburara-3.chebariss.io.
+chebariss.io.  IN  NS   cheburara-1.chebariss.io.
+chebariss.io.  IN  NS   cheburara-2.chebariss.io.
+
+; A records for each NS record
+cheburara-3  IN  A   192.168.43.96
+cheburara-1  IN  A   192.168.43.197
+cheburara-2  IN  A   192.168.43.24
+
+

changed: [cheburara-2]

TASK [bind : Create DNS Reverse Zone File if not existing] *********************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpbylu73tu/dns_rev.j2
@@ -0,0 +1,24 @@
+; BIND data file for 168.192.in-addr.arpa zone
+;
+$TTL    604800
+@       IN      SOA     ns.168.192.in-addr.arpa. admin.168.192.in-addr.arpa. (
+                             3         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+
+; NS records for each DNS server
+168.192.in-addr.arpa.  IN  NS   cheburara-3.chebariss.io.
+168.192.in-addr.arpa.  IN  NS   cheburara-1.chebariss.io.
+168.192.in-addr.arpa.  IN  NS   cheburara-2.chebariss.io.
+
+; A records for each NS record
+cheburara-3  IN  A   192.168.43.96
+cheburara-1  IN  A   192.168.43.197
+cheburara-2  IN  A   192.168.43.24
+
+; PTR records for VMs
+96.43  IN  PTR  cheburara-3.chebariss.io.
+197.43  IN  PTR  cheburara-1.chebariss.io.
+24.43  IN  PTR  cheburara-2.chebariss.io.

changed: [cheburara-1]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpib_iu9e7/dns_rev.j2
@@ -0,0 +1,24 @@
+; BIND data file for 168.192.in-addr.arpa zone
+;
+$TTL    604800
+@       IN      SOA     ns.168.192.in-addr.arpa. admin.168.192.in-addr.arpa. (
+                             3         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+
+; NS records for each DNS server
+168.192.in-addr.arpa.  IN  NS   cheburara-3.chebariss.io.
+168.192.in-addr.arpa.  IN  NS   cheburara-1.chebariss.io.
+168.192.in-addr.arpa.  IN  NS   cheburara-2.chebariss.io.
+
+; A records for each NS record
+cheburara-3  IN  A   192.168.43.96
+cheburara-1  IN  A   192.168.43.197
+cheburara-2  IN  A   192.168.43.24
+
+; PTR records for VMs
+96.43  IN  PTR  cheburara-3.chebariss.io.
+197.43  IN  PTR  cheburara-1.chebariss.io.
+24.43  IN  PTR  cheburara-2.chebariss.io.

changed: [cheburara-3]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpq_a821e_/dns_rev.j2
@@ -0,0 +1,24 @@
+; BIND data file for 168.192.in-addr.arpa zone
+;
+$TTL    604800
+@       IN      SOA     ns.168.192.in-addr.arpa. admin.168.192.in-addr.arpa. (
+                             3         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+
+; NS records for each DNS server
+168.192.in-addr.arpa.  IN  NS   cheburara-3.chebariss.io.
+168.192.in-addr.arpa.  IN  NS   cheburara-1.chebariss.io.
+168.192.in-addr.arpa.  IN  NS   cheburara-2.chebariss.io.
+
+; A records for each NS record
+cheburara-3  IN  A   192.168.43.96
+cheburara-1  IN  A   192.168.43.197
+cheburara-2  IN  A   192.168.43.24
+
+; PTR records for VMs
+96.43  IN  PTR  cheburara-3.chebariss.io.
+197.43  IN  PTR  cheburara-1.chebariss.io.
+24.43  IN  PTR  cheburara-2.chebariss.io.

changed: [cheburara-2]

RUNNING HANDLER [bind : Restart bind9] *****************************************
changed: [cheburara-1]
changed: [cheburara-3]
changed: [cheburara-2]

RUNNING HANDLER [bind : Reload Zone] *******************************************
changed: [cheburara-1]
changed: [cheburara-3]
changed: [cheburara-2]

TASK [bind : Ensure bind9 service is started and enabled] **********************
ok: [cheburara-1]
ok: [cheburara-3]
ok: [cheburara-2]

TASK [bind : Add A record for backup server using nsupdate] ********************
skipping: [cheburara-1]
skipping: [cheburara-2]
changed: [cheburara-3]

TASK [bind : Add CNAME record] *************************************************
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1]
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2]
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3] => (item=None)
changed: [cheburara-3]

TASK [bind : Add A record for backup server using nsupdate for reverse zone] ***
skipping: [cheburara-1]
skipping: [cheburara-2]
changed: [cheburara-3]

RUNNING HANDLER [bind : Restart bind9] *****************************************
changed: [cheburara-3]

TASK [bind : Include Exporter Tasks] *******************************************
included: /home/cheba/ica0002/roles/bind/tasks/exporters/main.yaml for cheburara-3, cheburara-1, cheburara-2

TASK [bind : Install Bind9 exporter from Ubuntu package repository] ************
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-3]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]

TASK [bind : Enable Bind9 exporter] ********************************************
ok: [cheburara-3]
ok: [cheburara-1]
ok: [cheburara-2]

PLAY [Resolver] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]
ok: [cheburara-1]
ok: [cheburara-2]

TASK [resolver : Configure /etc/resolv.conf] ***********************************
--- before: /etc/resolv.conf
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpp45klhtg/resolv.cnf.j2
@@ -1,19 +1,4 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+search chebariss.io
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.197
+nameserver 192.168.43.24

changed: [cheburara-3]
--- before: /etc/resolv.conf
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpmsw_q_ba/resolv.cnf.j2
@@ -1,19 +1,4 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+search chebariss.io
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.197
+nameserver 192.168.43.24

changed: [cheburara-2]
--- before: /etc/resolv.conf
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp9hf6rjls/resolv.cnf.j2
@@ -1,19 +1,4 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+search chebariss.io
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.197
+nameserver 192.168.43.24

changed: [cheburara-1]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Install MySQL Server package] ************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]

TASK [mysql : Install PyMySQL package] *****************************************
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]

TASK [mysql : Create override.cnf file] ****************************************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpfnswn2u4/mysql_override.cnf.j2
@@ -0,0 +1,8 @@
+[mysqld]
+bind-address = 0.0.0.0
+
+#Replication settings
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 280

changed: [cheburara-2]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpij82ydh0/mysql_override.cnf.j2
@@ -0,0 +1,8 @@
+[mysqld]
+bind-address = 0.0.0.0
+
+#Replication settings
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 453

changed: [cheburara-1]

TASK [mysql : Ensure mysql service is started and enabled] *********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : MySQL database] **************************************************
changed: [cheburara-1]
changed: [cheburara-2]

TASK [mysql : MySQL user] ******************************************************
changed: [cheburara-1]
changed: [cheburara-2]

TASK [mysql : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/mysql/tasks/exporters/main.yaml for cheburara-1, cheburara-2

TASK [mysql : Install MySQL Exporter from Ubuntu Repository] *******************
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]

TASK [mysql : Create MySQL 'exporter' User] ************************************
changed: [cheburara-1]
changed: [cheburara-2]

TASK [mysql : Create ~/.my.cnf for Exporter User] ******************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [mysql : Update Prometheus MySQL Exporter for Replication Metrics] ********
--- before: /etc/default/prometheus-mysqld-exporter (content)
+++ after: /etc/default/prometheus-mysqld-exporter (content)
@@ -118,3 +118,4 @@
 #  --log.format="logger:stderr"
 #       Set the log target and format. Example:
 #       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--collect.slave_status"

changed: [cheburara-2]
--- before: /etc/default/prometheus-mysqld-exporter (content)
+++ after: /etc/default/prometheus-mysqld-exporter (content)
@@ -118,3 +118,4 @@
 #  --log.format="logger:stderr"
 #       Set the log target and format. Example:
 #       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--collect.slave_status"

changed: [cheburara-1]

TASK [mysql : Ensure Exporter Restarts] ****************************************
changed: [cheburara-1]
changed: [cheburara-2]

TASK [mysql : Ensure mysql service is started and enabled] *********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure /home/backup/mysql directory exists] **********************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-2]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-1]

TASK [mysql : Create MySQL user 'backup' with privileges] **********************
changed: [cheburara-1]
changed: [cheburara-2]

TASK [mysql : Create MySQL client configuration file for user 'backup'] ********
changed: [cheburara-2]
changed: [cheburara-1]

TASK [mysql : Create Cron file] ************************************************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmps09_o3q9/mysql_backup_cron.j2
@@ -0,0 +1,2 @@
+0 16 * * * backup mysqldump agama > /home/backup/mysql/agama.sql && duplicity --no-encryption full /home/backup/mysql/ rsync://Cheburara@backup.chebariss.io/mysql
+0 16 * * 1-6 backup mysqldump agama > /home/backup/mysql/agama.sql && duplicity --no-encryption incremental /home/backup/mysql/ rsync://Cheburara@backup.chebariss.io/mysql

changed: [cheburara-2]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp56asxqs5/mysql_backup_cron.j2
@@ -0,0 +1 @@
+

changed: [cheburara-1]

TASK [mysql : Create MySQL user 'replication' with privileges] *****************
changed: [cheburara-1]
changed: [cheburara-2]

TASK [mysql : MySQL read only mode configuration] ******************************
changed: [cheburara-2]
changed: [cheburara-1]

RUNNING HANDLER [mysql : Restart Mysql] ****************************************
changed: [cheburara-2]
changed: [cheburara-1]

RUNNING HANDLER [mysql : Restart mysql source] *********************************
skipping: [cheburara-2] => (item=stopslave) 
skipping: [cheburara-2] => (item=resetmaster) 
ok: [cheburara-1] => (item=stopslave)
changed: [cheburara-1] => (item=resetmaster)

RUNNING HANDLER [mysql : Restart mysql replica] ********************************
skipping: [cheburara-1] => (item=stopslave) 
skipping: [cheburara-1] => (item=changemaster) 
skipping: [cheburara-1] => (item=resetslave) 
skipping: [cheburara-1] => (item=startslave) 
ok: [cheburara-2] => (item=stopslave)
changed: [cheburara-2] => (item=changemaster)
changed: [cheburara-2] => (item=resetslave)
changed: [cheburara-2] => (item=startslave)

RUNNING HANDLER [mysql : Restart Prometheus MySQL Exporter] ********************
changed: [cheburara-2]
changed: [cheburara-1]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [nginx : Install Nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-3]

TASK [nginx : Copy custom Nginx default configuration] *************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpm4cudps4/default.j2
@@ -1,91 +1,27 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
+    listen 80 default_server;
+    server_name _;
 
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
+    location / {
+        proxy_set_header Host $host;
+        proxy_pass http://localhost:8001;
+    }
 
-	root /var/www/html;
+    location /prometheus {
+        proxy_pass http://localhost:9090;
+    }
 
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+    location /grafana {
+        proxy_set_header Host $http_host;
+        proxy_pass http://localhost:3001;
+    }
 }
 
+server {
+    listen localhost:8080;
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    location /stub_status {
+        stub_status;
+    }
+}

changed: [cheburara-3]

TASK [nginx : Start Nginx and enable it at boot] *******************************
ok: [cheburara-3]

TASK [nginx : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/nginx/tasks/exporters/main.yaml for cheburara-3

TASK [nginx : Install Nginx exporter from Ubuntu package repository] ***********
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-3]

TASK [nginx : Enable exporter service] *****************************************
changed: [cheburara-3]

TASK [prometheus : Install Prometheus] *****************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc
Suggested packages:
  npm
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc prometheus
0 upgraded, 19 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-3]

TASK [prometheus : Create Prometheus Configuration Directory] ******************
ok: [cheburara-3]

TASK [prometheus : Configure Prometheus] ***************************************
--- before: /etc/prometheus/prometheus.yml
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmphgqa3mpm/prometheus.yml.j2
@@ -1,44 +1,51 @@
-# Sample config for Prometheus.
+global:
+  scrape_interval: 15s
 
-global:
-  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
-  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
-  # scrape_timeout is set to the global default (10s).
-
-  # Attach these labels to any time series or alerts when communicating with
-  # external systems (federation, remote storage, Alertmanager).
-  external_labels:
-      monitor: 'example'
-
-# Alertmanager configuration
-alerting:
-  alertmanagers:
-  - static_configs:
-    - targets: ['localhost:9093']
-
-# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
-rule_files:
-  # - "first_rules.yml"
-  # - "second_rules.yml"
-
-# A scrape configuration containing exactly one endpoint to scrape:
-# Here it's Prometheus itself.
 scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
   - job_name: 'prometheus'
-
-    # Override the global default and scrape targets from this job every 5 seconds.
-    scrape_interval: 5s
-    scrape_timeout: 5s
-
-    # metrics_path defaults to '/metrics'
-    # scheme defaults to 'http'.
-
     static_configs:
       - targets: ['localhost:9090']
+    metrics_path: /prometheus/metrics 
 
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
+  - job_name: 'linux'
     static_configs:
-      - targets: ['localhost:9100']
+            - targets: ['cheburara-1:9100']
+            - targets: ['cheburara-2:9100']
+            - targets: ['cheburara-3:9100']
+        
+  - job_name: 'mysql_exporter'
+    static_configs:
+            - targets: ['cheburara-1:9104']
+            - targets: ['cheburara-2:9104']
+        
+  - job_name: 'bind_exporter'
+    static_configs:
+            - targets: ['cheburara-3:9119']
+            - targets: ['cheburara-1:9119']
+            - targets: ['cheburara-2:9119']
+        
+  - job_name: 'nginx_exporter'
+    static_configs:
+            - targets: ['cheburara-1:9113']
+            - targets: ['cheburara-2:9113']
+      
+  - job_name: 'influxdb-stats-exporter'
+    static_configs:
+            - targets: ['cheburara-3:9424']
+        
+  - job_name: 'prometheus-haproxy-exporter'
+    static_configs:
+            - targets: ['cheburara-1:9101']
+            - targets: ['cheburara-2:9101']
+          
+  
+  - job_name: 'keepalived-exporter'
+    static_configs:
+            - targets: ['cheburara-1:9165']
+            - targets: ['cheburara-2:9165']
+        
+ 
+  
+  
+  
+    

changed: [cheburara-3]

TASK [prometheus : Configure Prometheus] ***************************************
--- before: /etc/default/prometheus
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpzsniaemz/prometheus.default.j2
@@ -1,57 +1 @@
-# Set the command-line arguments to pass to the server.
-ARGS=""
-
-# Prometheus supports the following options:
-#  --config.file="/etc/prometheus/prometheus.yml"
-#                             Prometheus configuration file path.
-#  --web.listen-address="0.0.0.0:9090"
-#                             Address to listen on for UI, API, and telemetry.
-#  --web.read-timeout=5m      Maximum duration before timing out read of the
-#                             request, and closing idle connections.
-#  --web.max-connections=512  Maximum number of simultaneous connections.
-#  --web.external-url=<URL>   The URL under which Prometheus is externally
-#                             reachable (for example, if Prometheus is served
-#                             via a reverse proxy). Used for generating
-#                             relative and absolute links back to Prometheus
-#                             itself. If the URL has a path portion, it will
-#                             be used to prefix all HTTP endpoints served by
-#                             Prometheus. If omitted, relevant URL components
-#                             will be derived automatically.
-#  --web.route-prefix=<path>  Prefix for the internal routes of web endpoints.
-#                             Defaults to path of --web.external-url.
-#  --web.local-assets="/usr/share/prometheus/web/"
-#                             Path to static asset/templates directory.
-#  --web.user-assets=<path>   Path to static asset directory, available at
-#                             /user.
-#  --web.enable-lifecycle     Enable shutdown and reload via HTTP request.
-#  --web.enable-admin-api     Enables API endpoints for admin control actions.
-#  --web.console.templates="/etc/prometheus/consoles"
-#                             Path to the console template directory,
-#                             available at /consoles.
-#  --web.console.libraries="/etc/prometheus/console_libraries"
-#                             Path to the console library directory.
-#  --storage.tsdb.path="/var/lib/prometheus/metrics2/"
-#                             Base path for metrics storage.
-#  --storage.tsdb.min-block-duration=2h
-#                             Minimum duration of a data block before being
-#                             persisted.
-#  --storage.tsdb.max-block-duration=<duration>
-#                             Maximum duration compacted blocks may span.
-#                             (Defaults to 10% of the retention period)
-#  --storage.tsdb.retention=15d
-#                             How long to retain samples in the storage.
-#  --storage.tsdb.use-lockfile
-#                             Create a lockfile in data directory.
-#  --alertmanager.notification-queue-capacity=10000
-#                             The capacity of the queue for pending alert
-#                             manager notifications.
-#  --alertmanager.timeout=10s
-#                             Timeout for sending alerts to Alertmanager.
-#  --query.lookback-delta=5m  The delta difference allowed for retrieving
-#                             metrics during expression evaluations.
-#  --query.timeout=2m         Maximum time a query may take before being
-#                             aborted.
-#  --query.max-concurrency=20
-#                             Maximum number of queries executed concurrently.
-#  --log.level=info           Only log messages with the given severity or
-#                             above. One of: [debug, info, warn, error]
+ARGS="--web.external-url=http://[ansible_default_ipv4]/prometheus"

changed: [cheburara-3]

TASK [prometheus : Start and Enable Prometheus Service] ************************
ok: [cheburara-3]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [cheburara-3]

RUNNING HANDLER [nginx : Restart Nginx exporter] *******************************
changed: [cheburara-3]

RUNNING HANDLER [prometheus : Restart Prometheus] ******************************
changed: [cheburara-3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [docker : Install Docker packages] ****************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz python3-websocket runc
  ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-3]

TASK [docker : Enable Docker service] ******************************************
ok: [cheburara-3]

TASK [grafana : Create Grafana directory] **************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-3]

TASK [grafana : Grafana configuration] *****************************************
changed: [cheburara-3]

TASK [grafana : Install Grafana in Docker container] ***************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

[DEPRECATION WARNING]: The container_default_behavior option will change its 
default value from "compatibility" to "no_defaults" in community.docker 2.0.0. 
To remove this warning, please specify an explicit value for it now. This 
feature will be removed from community.docker in version 2.0.0. Deprecation 
warnings can be disabled by setting deprecation_warnings=False in ansible.cfg.
changed: [cheburara-3]

TASK [grafana : Create Grafana directories] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-3] => (item=/opt/grafana/provisioning/dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-3] => (item=/opt/grafana/provisioning/datasources)

TASK [grafana : Copy dashboard configurations] *********************************
--- before
+++ after: /home/cheba/ica0002/roles/grafana/tasks/dashboard-source.yaml
@@ -0,0 +1,34 @@
+apiVersion: 1
+
+providers:
+  - name: 'Main Dashboard'
+    orgID: 1
+    type: file
+    disableDeletion: false
+    options:
+      path: /etc/grafana/provisioning/dashboards
+
+  - name: 'Syslog Dashboard'
+    orgID: 1
+    type: file
+    disableDeletion: false
+    options:
+      path: /etc/grafana/provisioning/dashboards
+  
+  - name: 'MySQL Dashboard'
+    orgID: 1
+    type: file
+    disableDeletion: false
+    options:
+      path: /etc/grafana/provisioning/dashboards
+    
+  - name: 'HAProxy and Keepalived Dashboard'
+    orgID: 1
+    type: file
+    disableDeletion: false
+    options:
+      path: /etc/grafana/provisioning/dashboards
+
+      
+
+      

changed: [cheburara-3] => (item={'src': 'dashboard-source.yaml', 'dest': '/opt/grafana/provisioning/dashboards/dashboard-source.yaml'})
--- before
+++ after: /home/cheba/ica0002/roles/grafana/tasks/datasource.yaml
@@ -0,0 +1,32 @@
+apiVersion: 1
+
+datasources:
+  - name: Prometheus
+    type: prometheus
+    access: proxy
+    orID: 1
+    url: http://prometheus:9090/prometheus/
+    isDefault: true
+
+  - name: influxdb:influxdb_cheburara
+    type: influxdb
+    orID: 1
+    access: proxy
+    url: http://influxdb:8086
+    database: influxdb_cheburara
+    isDefault: False 
+
+  - name: influxdb:telegarf
+    type: influxdb
+    orID: 1
+    access: proxy
+    url: http://influxdb:8086
+    database: telegraf
+    isDefault: False 
+    
+
+    
+  
+
+
+

changed: [cheburara-3] => (item={'src': 'datasource.yaml', 'dest': '/opt/grafana/provisioning/datasources/datasource.yaml'})
--- before
+++ after: /home/cheba/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,1051 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "links": [
+    {
+      "asDropdown": false,
+      "icon": "external link",
+      "includeVars": false,
+      "keepTime": false,
+      "tags": [],
+      "targetBlank": false,
+      "title": "Syslog",
+      "tooltip": "",
+      "type": "dashboards",
+      "url": ""
+    }
+  ],
+  "liveNow": false,
+  "panels": [
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "prometheus"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "hiddenSeries": false,
+      "id": 2,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "expr": "(node_memory_MemTotal_bytes - node_memory_MemFree_bytes) / node_memory_MemTotal_bytes * 100",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "Memory Consumption",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "prometheus"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "hiddenSeries": false,
+      "id": 1,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "expr": "node_load1",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "CPU Load",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "prometheus"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 7,
+        "x": 0,
+        "y": 8
+      },
+      "hiddenSeries": false,
+      "id": 3,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "expr": "rate(bind_resolver_queries_total{type=\"A\"}[1m])",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "Bind9 Status + DNS Queries",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "prometheus"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 7,
+        "y": 8
+      },
+      "hiddenSeries": false,
+      "id": 4,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "expr": "rate(mysql_global_status_commands_total{command='select'}[1m])",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "MySQL Status + Selects",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "prometheus"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 9,
+        "x": 15,
+        "y": 8
+      },
+      "hiddenSeries": false,
+      "id": 5,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "expr": "rate(nginx_http_requests_total[1m])",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "Nginx Status + Requests",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P3168EDBD1FFBB4A6"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 6,
+        "w": 24,
+        "x": 0,
+        "y": 15
+      },
+      "hiddenSeries": false,
+      "id": 6,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P3168EDBD1FFBB4A6"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "rtt",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "mean"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "dst::tag",
+              "operator": "=",
+              "value": "youtube.com"
+            }
+          ]
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "Latency Monitoring",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P3168EDBD1FFBB4A6"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 21
+      },
+      "hiddenSeries": false,
+      "id": 7,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P3168EDBD1FFBB4A6"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "rtt",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "mean"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "dst::tag",
+              "operator": "=",
+              "value": "youtube.com"
+            }
+          ]
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "InfluxDB health (influxdb_exporter_stats_query_success)",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P3168EDBD1FFBB4A6"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 21
+      },
+      "hiddenSeries": false,
+      "id": 8,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P3168EDBD1FFBB4A6"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "rtt",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "mean"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "dst::tag",
+              "operator": "=",
+              "value": "youtube.com"
+            }
+          ]
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "InfluxDB write rate (influxdb_write_write_ok)",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "🤡"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "🥳"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "max": 1,
+          "min": 0,
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 8,
+        "x": 0,
+        "y": 29
+      },
+      "id": 11,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "vertical",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {},
+        "textMode": "value",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "exemplar": true,
+          "expr": "bind_up",
+          "interval": "",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9 server status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "🤡"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "🥳"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "max": 1,
+          "min": 0,
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 8,
+        "x": 8,
+        "y": 29
+      },
+      "id": 9,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "vertical",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {},
+        "textMode": "value",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "exemplar": true,
+          "expr": "mysql_up",
+          "interval": "",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL server status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "🤡"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "🥳"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "max": 1,
+          "min": 0,
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 8,
+        "x": 16,
+        "y": 29
+      },
+      "id": 10,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "vertical",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {},
+        "textMode": "value",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "exemplar": true,
+          "expr": "nginx_up",
+          "interval": "",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx server status",
+      "type": "stat"
+    }
+  ],
+  "refresh": "",
+  "schemaVersion": 38,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "Main",
+  "uid": "d7de75eb-d7a1-4e2b-8b3b-6cc492d23dc6",
+  "version": 9,
+  "weekStart": ""
+}

changed: [cheburara-3] => (item={'src': 'main.json', 'dest': '/opt/grafana/provisioning/dashboards/main.json'})
--- before
+++ after: /home/cheba/ica0002/roles/grafana/files/syslog.json
@@ -0,0 +1,1041 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "datasource",
+          "uid": "grafana"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "description": "Telegraf / InfluxDB / Grafana as syslog receiver",
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "gnetId": 12433,
+  "graphTooltip": 0,
+  "links": [
+    {
+      "asDropdown": false,
+      "icon": "external link",
+      "includeVars": false,
+      "keepTime": false,
+      "tags": [],
+      "targetBlank": false,
+      "title": "Syslog",
+      "tooltip": "",
+      "type": "dashboards",
+      "url": ""
+    }
+  ],
+  "liveNow": false,
+  "panels": [
+    {
+      "aliasColors": {},
+      "bars": true,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P90B34F6775D393A8"
+      },
+      "decimals": 0,
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "hiddenSeries": false,
+      "id": 10,
+      "interval": "",
+      "legend": {
+        "alignAsTable": true,
+        "avg": true,
+        "current": false,
+        "max": true,
+        "min": false,
+        "rightSide": true,
+        "show": true,
+        "total": true,
+        "values": true
+      },
+      "lines": false,
+      "linewidth": 1,
+      "links": [],
+      "nullPointMode": "connected",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.0",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [
+        {
+          "alias": "Info",
+          "color": "rgb(80, 80, 80)",
+          "stack": "A"
+        },
+        {
+          "alias": "Notice",
+          "color": "rgb(182, 182, 182)",
+          "stack": "A"
+        },
+        {
+          "alias": "Warning",
+          "color": "#E0B400",
+          "stack": "A"
+        },
+        {
+          "alias": "Error",
+          "color": "#FF780A",
+          "stack": "A"
+        },
+        {
+          "alias": "Critical",
+          "color": "#E02F44",
+          "stack": "A"
+        },
+        {
+          "alias": "Alert",
+          "color": "#8F3BB8",
+          "stack": "A"
+        },
+        {
+          "alias": "Emergency",
+          "color": "#8F3BB8",
+          "stack": "A"
+        }
+      ],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "alias": "Info",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "info"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Notice",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "B",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "notice"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Warning",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "D",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "warning"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Error",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "C",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "err"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Critical",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "E",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "crit"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Alert",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "F",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "alert"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Emergency",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "G",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "emerg"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "syslog count",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "decimals": 0,
+          "format": "none",
+          "label": "Messages / min",
+          "logBase": 1,
+          "show": true
+        },
+        {
+          "format": "short",
+          "logBase": 1,
+          "show": false
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P90B34F6775D393A8"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "custom": {
+            "align": "left",
+            "cellOptions": {
+              "type": "auto"
+            },
+            "filterable": false,
+            "inspect": false
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-purple",
+                "value": null
+              },
+              {
+                "color": "dark-red",
+                "value": 2
+              },
+              {
+                "color": "dark-orange",
+                "value": 3
+              },
+              {
+                "color": "dark-yellow",
+                "value": 4
+              },
+              {
+                "color": "rgb(150, 150, 150)",
+                "value": 5
+              },
+              {
+                "color": "rgb(51, 51, 51)",
+                "value": 6
+              },
+              {
+                "color": "rgb(5, 5, 5)",
+                "value": 7
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "severity_code"
+            },
+            "properties": [
+              {
+                "id": "mappings",
+                "value": [
+                  {
+                    "options": {
+                      "0": {
+                        "text": "Emergency"
+                      },
+                      "1": {
+                        "text": "Alert"
+                      },
+                      "2": {
+                        "text": "Critical"
+                      },
+                      "3": {
+                        "text": "Error"
+                      },
+                      "4": {
+                        "text": "Warning"
+                      },
+                      "5": {
+                        "text": "Notice"
+                      },
+                      "6": {
+                        "text": "Info"
+                      },
+                      "7": {
+                        "text": "Debug"
+                      }
+                    },
+                    "type": "value"
+                  }
+                ]
+              },
+              {
+                "id": "custom.cellOptions",
+                "value": {
+                  "mode": "gradient",
+                  "type": "color-background"
+                }
+              },
+              {
+                "id": "custom.width",
+                "value": 119
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Time"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 163
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "hostname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 194
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "appname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 264
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 24,
+        "w": 24,
+        "x": 0,
+        "y": 7
+      },
+      "id": 12,
+      "options": {
+        "cellHeight": "sm",
+        "footer": {
+          "countRows": false,
+          "fields": "",
+          "reducer": [
+            "sum"
+          ],
+          "show": false
+        },
+        "showHeader": true,
+        "sortBy": [
+          {
+            "desc": true,
+            "displayName": "Time"
+          }
+        ]
+      },
+      "pluginVersion": "10.2.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P90B34F6775D393A8"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "hostname"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "appname"
+              ],
+              "type": "tag"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "table",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              }
+            ],
+            [
+              {
+                "params": [
+                  "message"
+                ],
+                "type": "field"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "title": "Syslog Messages",
+      "type": "table"
+    }
+  ],
+  "refresh": "5s",
+  "schemaVersion": 38,
+  "tags": [],
+  "templating": {
+    "list": [
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "influxdb",
+          "uid": "P90B34F6775D393A8"
+        },
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "hide": 0,
+        "includeAll": true,
+        "label": "Appname",
+        "multi": true,
+        "name": "appname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "tagValuesQuery": "",
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "influxdb",
+          "uid": "P90B34F6775D393A8"
+        },
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "hide": 0,
+        "includeAll": true,
+        "label": "Hostname",
+        "multi": true,
+        "name": "hostname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "tagValuesQuery": "",
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "influxdb",
+          "uid": "P90B34F6775D393A8"
+        },
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "hide": 0,
+        "includeAll": true,
+        "label": "Severity",
+        "multi": true,
+        "name": "severity",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 0,
+        "tagValuesQuery": "",
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "current": {
+          "selected": false,
+          "text": "",
+          "value": ""
+        },
+        "description": "Querystring",
+        "hide": 0,
+        "label": "MessageQuery",
+        "name": "Query",
+        "options": [
+          {
+            "selected": true,
+            "text": "",
+            "value": ""
+          }
+        ],
+        "query": "",
+        "skipUrlSync": false,
+        "type": "textbox"
+      }
+    ]
+  },
+  "time": {
+    "from": "now-1h",
+    "to": "now"
+  },
+  "timepicker": {
+    "refresh_intervals": [
+      "5s",
+      " 10s",
+      " 30s",
+      " 1m",
+      " 5m"
+    ],
+    "time_options": [
+      "5m",
+      "15m",
+      "1h",
+      "6h",
+      "12h",
+      "24h",
+      "2d",
+      "7d",
+      "30d"
+    ]
+  },
+  "timezone": "",
+  "title": "Syslog",
+  "uid": "0",
+  "version": 2,
+  "weekStart": ""
+}

changed: [cheburara-3] => (item={'src': 'syslog.json', 'dest': '/opt/grafana/provisioning/dashboards/syslog.json'})
--- before
+++ after: /home/cheba/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,565 @@
+{
+    "annotations": {
+      "list": [
+        {
+          "builtIn": 1,
+          "datasource": {
+            "type": "datasource",
+            "uid": "grafana"
+          },
+          "enable": true,
+          "hide": true,
+          "iconColor": "rgba(0, 211, 255, 1)",
+          "name": "Annotations & Alerts",
+          "target": {
+            "limit": 100,
+            "matchAny": false,
+            "tags": [],
+            "type": "dashboard"
+          },
+          "type": "dashboard"
+        }
+      ]
+    },
+    "editable": true,
+    "fiscalYearStartMonth": 0,
+    "graphTooltip": 0,
+    "id": 1,
+    "links": [
+      {
+        "asDropdown": false,
+        "icon": "external link",
+        "includeVars": false,
+        "keepTime": false,
+        "tags": [],
+        "targetBlank": false,
+        "title": "Syslog",
+        "tooltip": "",
+        "type": "dashboards",
+        "url": ""
+      }
+    ],
+    "liveNow": false,
+    "panels": [
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "red",
+                    "index": 1,
+                    "text": "🤡"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 0,
+                    "text": "🥳"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "max": 1,
+            "min": 0,
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 1
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 24,
+          "x": 0,
+          "y": 0
+        },
+        "id": 14,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "vertical",
+          "reduceOptions": {
+            "calcs": [
+              "last"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "text": {},
+          "textMode": "value",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "exemplar": true,
+            "expr": "mysql_up",
+            "interval": "",
+            "legendFormat": "{{instance}}",
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL server status",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [],
+            "max": 1,
+            "min": 0,
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 1
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 24,
+          "x": 0,
+          "y": 3
+        },
+        "id": 12,
+        "options": {
+          "colorMode": "none",
+          "graphMode": "none",
+          "justifyMode": "center",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "last"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "text": {},
+          "textMode": "value",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "exemplar": true,
+            "expr": "mysql_global_variables_server_id",
+            "interval": "",
+            "legendFormat": "{{instance}}",
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL server id",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "orange",
+                    "index": 1,
+                    "text": "Read/write"
+                  },
+                  "1": {
+                    "color": "blue",
+                    "index": 0,
+                    "text": "Read only"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "max": 1,
+            "min": 0,
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 1
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 24,
+          "x": 0,
+          "y": 6
+        },
+        "id": 13,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "last"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "text": {},
+          "textMode": "value",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "exemplar": true,
+            "expr": "mysql_global_variables_read_only",
+            "interval": "",
+            "legendFormat": "{{instance}}",
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL server mode",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "orange",
+                    "index": 1,
+                    "text": "Stopped"
+                  },
+                  "1": {
+                    "color": "blue",
+                    "index": 0,
+                    "text": "Running"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "max": 1,
+            "min": 0,
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 1
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 24,
+          "x": 0,
+          "y": 9
+        },
+        "id": 16,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "last"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "text": {},
+          "textMode": "value",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "exemplar": true,
+            "expr": "mysql_slave_status_slave_io_running",
+            "interval": "",
+            "legendFormat": "{{instance}}",
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL replica IO thread",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "#FF9830",
+                    "index": 1,
+                    "text": "Stopped"
+                  },
+                  "1": {
+                    "color": "blue",
+                    "index": 0,
+                    "text": "Running"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "max": 1,
+            "min": 0,
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 1
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 24,
+          "x": 0,
+          "y": 12
+        },
+        "id": 17,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "last"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "text": {},
+          "textMode": "value",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "exemplar": true,
+            "expr": "mysql_slave_status_slave_sql_running",
+            "interval": "",
+            "legendFormat": "{{instance}}",
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL replica SQL thread",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            },
+            "unit": "ops"
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 24,
+          "x": 0,
+          "y": 15
+        },
+        "id": 15,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "exemplar": true,
+            "expr": "rate(mysql_global_status_commands_total{command=~\"select|show_status|update\"}[5m])",
+            "interval": "",
+            "legendFormat": "{{instance}}: {{command}}",
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL query rate",
+        "type": "timeseries"
+      }
+    ],
+    "refresh": "30s",
+    "schemaVersion": 38,
+    "tags": [],
+    "templating": {
+      "list": []
+    },
+    "time": {
+      "from": "now-1h",
+      "to": "now"
+    },
+    "timepicker": {},
+    "timezone": "",
+    "title": "MySQL",
+    "uid": "mysql",
+    "version": 1,
+    "weekStart": ""
+  }

changed: [cheburara-3] => (item={'src': 'mysql.json', 'dest': '/opt/grafana/provisioning/dashboards/mysql.json'})
--- before
+++ after: /home/cheba/ica0002/roles/grafana/files/haproxy_keepalived.json
@@ -0,0 +1,252 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 4,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "id": 2,
+      "options": {
+        "minVizHeight": 75,
+        "minVizWidth": 75,
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showThresholdLabels": false,
+        "showThresholdMarkers": true
+      },
+      "pluginVersion": "10.2.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "keepalived_vrrp_state",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "Panel Title",
+      "type": "gauge"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "id": 1,
+      "options": {
+        "minVizHeight": 75,
+        "minVizWidth": 75,
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showThresholdLabels": false,
+        "showThresholdMarkers": true
+      },
+      "pluginVersion": "10.2.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "haproxy_up",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "Panel Title",
+      "type": "gauge"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 24,
+        "x": 0,
+        "y": 8
+      },
+      "id": 3,
+      "options": {
+        "minVizHeight": 75,
+        "minVizWidth": 75,
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showThresholdLabels": false,
+        "showThresholdMarkers": true
+      },
+      "pluginVersion": "10.2.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "haproxy_server_up",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "haproxy_server_up",
+      "type": "gauge"
+    }
+  ],
+  "refresh": "",
+  "schemaVersion": 38,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "HAProxy and Keepalived",
+  "uid": "bbbd2626-afbf-40fa-ba87-0234a321f8f3",
+  "version": 4,
+  "weekStart": ""
+}

changed: [cheburara-3] => (item={'src': 'haproxy_keepalived.json', 'dest': '/opt/grafana/provisioning/dashboards/haproxy_keepalived.json'})
--- before
+++ after: /home/cheba/ica0002/roles/grafana/files/status.json
@@ -0,0 +1,942 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 2,
+  "links": [
+    {
+      "asDropdown": false,
+      "icon": "external link",
+      "includeVars": false,
+      "keepTime": false,
+      "tags": [],
+      "targetBlank": false,
+      "title": "Main",
+      "tooltip": "",
+      "type": "dashboards",
+      "url": ""
+    }
+  ],
+  "liveNow": false,
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 7,
+        "x": 0,
+        "y": 0
+      },
+      "id": 7,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.3",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "haproxy_up",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "HAPROXY service status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 0,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 1,
+                  "text": "SLAVE"
+                },
+                "2": {
+                  "color": "dark-green",
+                  "index": 2,
+                  "text": "MASTER"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 7,
+        "y": 0
+      },
+      "id": 5,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.3",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "keepalived_vrrp_state",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "Keepalived VRRP State",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                },
+                "2": {
+                  "color": "dark-green",
+                  "index": 2,
+                  "text": "MASTER"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 9,
+        "x": 15,
+        "y": 0
+      },
+      "id": 2,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.3",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "exemplar": true,
+          "expr": "bind_up",
+          "interval": "",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9 server status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 7,
+        "x": 0,
+        "y": 7
+      },
+      "id": 1,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.3",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "mysql_up{instance=\"cheburara-1:9104\"}",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "mysql_up{instance=\"cheburara-2:9104\"}",
+          "fullMetaSearch": false,
+          "hide": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "B",
+          "useBackend": false
+        }
+      ],
+      "title": "Mysql service status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 11,
+        "x": 7,
+        "y": 7
+      },
+      "id": 8,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.3",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "haproxy_server_up",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "Haproxy server status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 2,
+        "x": 18,
+        "y": 7
+      },
+      "id": 9,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.3",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "influxdb_exporter_stats_query_success",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "InfluxDB status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 4,
+        "x": 20,
+        "y": 7
+      },
+      "id": 4,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "10.2.3",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "exemplar": true,
+          "expr": "nginx_up",
+          "interval": "",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx server status",
+      "type": "stat"
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P3168EDBD1FFBB4A6"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 0,
+        "y": 14
+      },
+      "hiddenSeries": false,
+      "id": 10,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.3",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P3168EDBD1FFBB4A6"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "rtt",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "mean"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "dst::tag",
+              "operator": "=",
+              "value": "youtube.com"
+            }
+          ]
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "Latency Monitoring",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "prometheus"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 8,
+        "y": 14
+      },
+      "hiddenSeries": false,
+      "id": 11,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.3",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "expr": "rate(bind_resolver_queries_total{type=\"A\"}[1m])",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "Bind9 Status + DNS Queries",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "prometheus"
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 16,
+        "y": 14
+      },
+      "hiddenSeries": false,
+      "id": 12,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "10.2.3",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "expr": "rate(mysql_global_status_commands_total{command='select'}[1m])",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "MySQL Status + Selects",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "show": true
+        },
+        {
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    }
+  ],
+  "refresh": "auto",
+  "schemaVersion": 39,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "Status",
+  "uid": "a87073f4-3bc3-42f9-803c-155c71d89dc9",
+  "version": 4,
+  "weekStart": ""
+}

changed: [cheburara-3] => (item={'src': 'status.json', 'dest': '/opt/grafana/provisioning/dashboards/status.json'})

RUNNING HANDLER [grafana : Restart Grafana Container] **************************
changed: [cheburara-3]

PLAY [InfluxDB] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [influxdb : Create destination directory] *********************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/influx",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-3]

TASK [influxdb : Download InfluxDB 1.8.10 package] *****************************
changed: [cheburara-3]

TASK [influxdb : Install InfluxDB] *********************************************
Selecting previously unselected package influxdb.
(Reading database ... 66377 files and directories currently installed.)
Preparing to unpack .../influxdb_1.8.10_amd64.deb ...
Unpacking influxdb (1.8.10-1) ...
Setting up influxdb (1.8.10-1) ...
Processing triggers for man-db (2.9.1-1) ...
changed: [cheburara-3]

TASK [influxdb : Copy InfluxDB configuration file] *****************************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp96a5i5xb/influxdb.conf.j2
@@ -0,0 +1,6 @@
+[http]
+log-enabled = false
+write-tracing = false
+
+[data]
+query-log-enabled = false
\ No newline at end of file

changed: [cheburara-3]

TASK [influxdb : Start InfluxDB service] ***************************************
changed: [cheburara-3]

TASK [influxdb : Add InfluxData GPG key] ***************************************
changed: [cheburara-3]

TASK [influxdb : Download Telegraf package] ************************************
changed: [cheburara-3]

TASK [influxdb : Install Telegraf] *********************************************
Selecting previously unselected package telegraf.
(Reading database ... 66402 files and directories currently installed.)
Preparing to unpack .../telegraf_1.16.0-1_amd64.deb ...
Unpacking telegraf (1.16.0-1) ...
Setting up telegraf (1.16.0-1) ...
changed: [cheburara-3]

TASK [influxdb : Reconfigure Telegraf] *****************************************
diff skipped: destination file size is greater than 104448
changed: [cheburara-3]

TASK [influxdb : Start service telegraf] ***************************************
ok: [cheburara-3]

TASK [influxdb : Include Exporter Tasks] ***************************************
included: /home/cheba/ica0002/roles/influxdb/tasks/exporters/main.yaml for cheburara-3

TASK [influxdb : Get the latest release URL for InfluxDB Stats Exporter] *******
ok: [cheburara-3]

TASK [influxdb : Download InfluxDB Stats Exporter binary] **********************
changed: [cheburara-3]

TASK [influxdb : Create systemd service for InfluxDB Stats Exporter] ***********
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp61z49e55/influxdb-stats-exporter.service.j2
@@ -0,0 +1,12 @@
+[Unit]
+Description=InfluxDB Stats Exporter
+After=network.target
+
+[Service]
+User=prometheus
+Group=prometheus
+ExecStart=/usr/local/bin/influxdb_stats_exporter
+Restart=always
+
+[Install]
+WantedBy=multi-user.target

changed: [cheburara-3]

TASK [influxdb : Enable and start InfluxDB Stats Exporter] *********************
changed: [cheburara-3]

TASK [influxdb : Ensure /home/backup/influxdb directory exists] ****************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/influxdb",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-3]

TASK [influxdb : Create Cron tab file for InfluxDB backup] *********************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpd7p823it/influxdb_backup_cron.j2
@@ -0,0 +1,2 @@
+0 13 * * * backup influxd backup -portable -database telegraf /home/backup/influxdb && duplicity --no-encryption full /home/backup/influxdb rsync://Cheburara@backup.chebariss.io/influxdb
+# 0 13 * * 1-6 backup influxd backup -portable -database telegraf /home/backup/influxdb && duplicity --no-encryption incremental /home/backup/influxdb rsync://Cheburara@backup.chebariss.io/influxdb

changed: [cheburara-3]

RUNNING HANDLER [influxdb : Restart InfluxDb service] **************************
changed: [cheburara-3]

RUNNING HANDLER [influxdb : restart telegraf] **********************************
changed: [cheburara-3]

RUNNING HANDLER [influxdb : Restart InfluxDB Stats Exporter] *******************
changed: [cheburara-3]

PLAY [Pinger] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [pinger : Install fping] **************************************************
The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-3]

TASK [pinger : Install curl] ***************************************************
The following additional packages will be installed:
  libcurl4
The following packages will be upgraded:
  curl libcurl4
2 upgraded, 0 newly installed, 0 to remove and 260 not upgraded.
changed: [cheburara-3]

TASK [pinger : Add the user "pinger"] ******************************************
changed: [cheburara-3]

TASK [pinger : Copy pinger.sh to /usr/local/bin/pinger] ************************
--- before
+++ after: /home/cheba/ica0002/roles/pinger/files/pinger.sh
@@ -0,0 +1,26 @@
+#!/bin/bash
+
+# Script contains several (more than 1) security issues.
+# Find them and fix them to get bonus on exam.
+# Problem example: SQL injection.
+
+for t in database_url database_name targets; do
+  if ! grep -q "^${t}=" /etc/pinger/pinger.conf; then
+    logger "$0 Failed to get $t from config"
+    exit 1
+  fi
+done
+
+which fping > /dev/null || (logger "fping not found"; exit 1)
+
+db_url=$(grep "^database_url=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+db_name=$(grep "^database_name=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+targets=$(grep "^targets=" /etc/pinger/pinger.conf | sed 's/^.*=//' | sed 's/\(,\|;\)/ /g')
+
+curl -i -XPOST "${db_url}/query" --data-urlencode "q=CREATE DATABASE $db_name" 1>/dev/null 2>/dev/null
+
+while true; do
+  result=$(fping -C1 -q $targets 2>&1 | awk '{print "rtt,dst="$1" rtt="$3}')
+  curl -i -XPOST "${db_url}/write?db=$db_name" --data-binary "$result" 1>/dev/null 2>/dev/null
+ sleep 1
+done
\ No newline at end of file

changed: [cheburara-3]

TASK [pinger : Create the /etc/pinger directory] *******************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/pinger",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-3]

TASK [pinger : Copy pinger.conf to /etc/pinger/pinger.conf] ********************
--- before
+++ after: /home/cheba/ica0002/roles/pinger/files/pinger.conf
@@ -0,0 +1,3 @@
+database_url=http://influxdb:8086
+database_name=influxdb_cheburara
+targets= youtube.com,google.com

changed: [cheburara-3]

TASK [pinger : Copy the pinger.service unit file] ******************************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpj4m3f071/pinger.service.j2
@@ -0,0 +1,14 @@
+[Unit]
+Description=helpme
+Documentation=https://github.com/romankuchin/ica0002-2023
+After=network-online.target
+
+
+[Service]
+User=pinger 
+ExecStart=/usr/local/bin/pinger
+
+[Install]
+WantedBy=multi-user.target
+
+

changed: [cheburara-3]

TASK [pinger : Start and enable the pinger service] ****************************
changed: [cheburara-3]

RUNNING HANDLER [pinger : Reload systemd] **************************************
changed: [cheburara-3]

PLAY [HAPoxy] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : Installation HAProxy] ******************************************
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]

TASK [haproxy : HAProxy Configuration] *****************************************
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmploqq5gcw/haproxy.conf.j2
@@ -7,15 +7,6 @@
 	user haproxy
 	group haproxy
 	daemon
-
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +23,20 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen my_ha_frontend
+   bind *:88
+   stats enable
+   stats uri /haproxy/stats
+
+               server agama-cheburara-1-1 cheburara-1:8001 check
+            server agama-cheburara-1-2 cheburara-1:8002 check
+                server agama-cheburara-2-1 cheburara-2:8001 check
+            server agama-cheburara-2-2 cheburara-2:8002 check
+    
+listen frontend 
+	bind *:9188
+	mode http
+	stats enable	
+	stats uri /stats
+	stats refresh 5s

changed: [cheburara-2]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp9ngtu1at/haproxy.conf.j2
@@ -7,15 +7,6 @@
 	user haproxy
 	group haproxy
 	daemon
-
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +23,20 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen my_ha_frontend
+   bind *:88
+   stats enable
+   stats uri /haproxy/stats
+
+               server agama-cheburara-1-1 cheburara-1:8001 check
+            server agama-cheburara-1-2 cheburara-1:8002 check
+                server agama-cheburara-2-1 cheburara-2:8001 check
+            server agama-cheburara-2-2 cheburara-2:8002 check
+    
+listen frontend 
+	bind *:9188
+	mode http
+	stats enable	
+	stats uri /stats
+	stats refresh 5s

changed: [cheburara-1]

TASK [haproxy : Ensure HAProxy is enabled] *************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [haproxy : HAProxy exporters] *********************************************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]

TASK [haproxy : Configure prometheus-haproxy-exporter] *************************
--- before: /etc/default/prometheus-haproxy-exporter (content)
+++ after: /etc/default/prometheus-haproxy-exporter (content)
@@ -33,3 +33,4 @@
 #  --log.format="logger:stderr"
 #    Set the log target and format. Example:
 #    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri=http://localhost:88/haproxy/stats;csv"

changed: [cheburara-2]
--- before: /etc/default/prometheus-haproxy-exporter (content)
+++ after: /etc/default/prometheus-haproxy-exporter (content)
@@ -33,3 +33,4 @@
 #  --log.format="logger:stderr"
 #    Set the log target and format. Example:
 #    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri=http://localhost:88/haproxy/stats;csv"

changed: [cheburara-1]

TASK [haproxy : Ensure HAProxy exporter is enabled] ****************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Installation of Keepalived] *********************************
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]

TASK [keepalived : Create keepalived_script user] ******************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [keepalived : Create home directory for keepalived_script user] ***********
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Create configuration for keepalived_script] *****************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpd1nihrfr/check_script.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '

changed: [cheburara-2]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpsv40aekf/check_script.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '

changed: [cheburara-1]

TASK [keepalived : Keepalived configuration] ***********************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [keepalived : Enable keepalived] ******************************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [keepalived : Ensure /usr/local/bin directory exists] *********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Download Keepalived Exporter Binary] ************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [keepalived : Extract and Install Keepalived Exporter Binary] *************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [keepalived : Configuration of Keepalived Exporter] ***********************
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpdviyy70e/keepalived_exporters.j2
@@ -0,0 +1,10 @@
+[Unit]
+Description=Keepalived Exporter
+After=network.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [cheburara-2]
--- before
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmp8vrtqvzl/keepalived_exporters.j2
@@ -0,0 +1,10 @@
+[Unit]
+Description=Keepalived Exporter
+After=network.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [cheburara-1]

TASK [keepalived : Start and Enable Keepalived Exporter] ***********************
changed: [cheburara-2]
changed: [cheburara-1]

RUNNING HANDLER [haproxy : Restart HAProxy] ************************************
changed: [cheburara-2]
changed: [cheburara-1]

RUNNING HANDLER [haproxy : Restart prometheus-haproxy-exporter] ****************
changed: [cheburara-2]
changed: [cheburara-1]

RUNNING HANDLER [keepalived : restart keepalived] ******************************
changed: [cheburara-1]
changed: [cheburara-2]

RUNNING HANDLER [keepalived : Restart Keepalived Exporter] *********************
changed: [cheburara-2]
changed: [cheburara-1]

PLAY [Web Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [docker : Install Docker packages] ****************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz python3-websocket runc
  ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz python3-websocket runc
  ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]

TASK [docker : Enable Docker service] ******************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [agama : Create Agama directory] ******************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-2]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [cheburara-1]

TASK [agama : Download AGAMA Application] **************************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [agama : Download Dockerfile] *********************************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [agama : Build Docker image for Agama] ************************************
changed: [cheburara-2]
changed: [cheburara-1]

TASK [agama : Start Agama containers] ******************************************
changed: [cheburara-1] => (item=None)
changed: [cheburara-2] => (item=None)
changed: [cheburara-1] => (item=None)
changed: [cheburara-1]
changed: [cheburara-2] => (item=None)
changed: [cheburara-2]

TASK [nginx : Install Nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]

TASK [nginx : Copy custom Nginx default configuration] *************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpjci68ovr/default.j2
@@ -1,91 +1,27 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
+    listen 80 default_server;
+    server_name _;
 
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
+    location / {
+        proxy_set_header Host $host;
+        proxy_pass http://localhost:8001;
+    }
 
-	root /var/www/html;
+    location /prometheus {
+        proxy_pass http://localhost:9090;
+    }
 
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+    location /grafana {
+        proxy_set_header Host $http_host;
+        proxy_pass http://localhost:3001;
+    }
 }
 
+server {
+    listen localhost:8080;
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    location /stub_status {
+        stub_status;
+    }
+}

changed: [cheburara-1]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/cheba/.ansible/tmp/ansible-local-55437dbsu1kf/tmpzdbf4vpa/default.j2
@@ -1,91 +1,27 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
+    listen 80 default_server;
+    server_name _;
 
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
+    location / {
+        proxy_set_header Host $host;
+        proxy_pass http://localhost:8001;
+    }
 
-	root /var/www/html;
+    location /prometheus {
+        proxy_pass http://localhost:9090;
+    }
 
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+    location /grafana {
+        proxy_set_header Host $http_host;
+        proxy_pass http://localhost:3001;
+    }
 }
 
+server {
+    listen localhost:8080;
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    location /stub_status {
+        stub_status;
+    }
+}

changed: [cheburara-2]

TASK [nginx : Start Nginx and enable it at boot] *******************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [nginx : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/nginx/tasks/exporters/main.yaml for cheburara-1, cheburara-2

TASK [nginx : Install Nginx exporter from Ubuntu package repository] ***********
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-1]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.
changed: [cheburara-2]

TASK [nginx : Enable exporter service] *****************************************
changed: [cheburara-2]
changed: [cheburara-1]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [cheburara-2]
changed: [cheburara-1]

RUNNING HANDLER [nginx : Restart Nginx exporter] *******************************
changed: [cheburara-2]
changed: [cheburara-1]

PLAY RECAP *********************************************************************
cheburara-1                : ok=88   changed=67   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
cheburara-2                : ok=88   changed=67   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
cheburara-3                : ok=86   changed=66   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

[WARNING]: Collection community.general does not support Ansible version 2.10.8

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Update APT cache] *************************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Install Prometheus Node Exporter] *********************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Start and Enable Node Exporter Service] ***************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Install up-to-date CA certificates] *******************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Install rsyslog] **************************************************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Create a custom rsyslog configuration file] ***********************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Modify a custom rsyslog configuration file] ***********************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Ensure the user 'backup' exists with a unique SSH key] ************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Create known_hosts file for user backup] **************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Ensure /home/backup/restore directory exists] *********************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Ensure Duplicity is installed] ************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

PLAY [DNS server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Install Bind9 package] ********************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Create configuration bind9 file] **********************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Create configuration bind9 for master and slave] ******************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Create DNS Zone File if not existing] *****************************
ok: [cheburara-2]
ok: [cheburara-3]
ok: [cheburara-1]

TASK [bind : Create DNS Reverse Zone File if not existing] *********************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Ensure bind9 service is started and enabled] **********************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Add A record for backup server using nsupdate] ********************
skipping: [cheburara-1]
skipping: [cheburara-2]
ok: [cheburara-3]

TASK [bind : Add CNAME record] *************************************************
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1]
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2]
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3]

TASK [bind : Add A record for backup server using nsupdate for reverse zone] ***
skipping: [cheburara-1]
skipping: [cheburara-2]
ok: [cheburara-3]

TASK [bind : Include Exporter Tasks] *******************************************
included: /home/cheba/ica0002/roles/bind/tasks/exporters/main.yaml for cheburara-3, cheburara-1, cheburara-2

TASK [bind : Install Bind9 exporter from Ubuntu package repository] ************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Enable Bind9 exporter] ********************************************
ok: [cheburara-2]
ok: [cheburara-3]
ok: [cheburara-1]

PLAY [Resolver] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [resolver : Configure /etc/resolv.conf] ***********************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Install MySQL Server package] ************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Install PyMySQL package] *****************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : Create override.cnf file] ****************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure mysql service is started and enabled] *********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : MySQL database] **************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : MySQL user] ******************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/mysql/tasks/exporters/main.yaml for cheburara-1, cheburara-2

TASK [mysql : Install MySQL Exporter from Ubuntu Repository] *******************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL 'exporter' User] ************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create ~/.my.cnf for Exporter User] ******************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Update Prometheus MySQL Exporter for Replication Metrics] ********
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure Exporter Restarts] ****************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure mysql service is started and enabled] *********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure /home/backup/mysql directory exists] **********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL user 'backup' with privileges] **********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL client configuration file for user 'backup'] ********
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create Cron file] ************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL user 'replication' with privileges] *****************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : MySQL read only mode configuration] ******************************
ok: [cheburara-2]
ok: [cheburara-1]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [nginx : Install Nginx] ***************************************************
ok: [cheburara-3]

TASK [nginx : Copy custom Nginx default configuration] *************************
ok: [cheburara-3]

TASK [nginx : Start Nginx and enable it at boot] *******************************
ok: [cheburara-3]

TASK [nginx : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/nginx/tasks/exporters/main.yaml for cheburara-3

TASK [nginx : Install Nginx exporter from Ubuntu package repository] ***********
ok: [cheburara-3]

TASK [nginx : Enable exporter service] *****************************************
ok: [cheburara-3]

TASK [prometheus : Install Prometheus] *****************************************
ok: [cheburara-3]

TASK [prometheus : Create Prometheus Configuration Directory] ******************
ok: [cheburara-3]

TASK [prometheus : Configure Prometheus] ***************************************
ok: [cheburara-3]

TASK [prometheus : Configure Prometheus] ***************************************
ok: [cheburara-3]

TASK [prometheus : Start and Enable Prometheus Service] ************************
ok: [cheburara-3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [docker : Install Docker packages] ****************************************
ok: [cheburara-3]

TASK [docker : Enable Docker service] ******************************************
ok: [cheburara-3]

TASK [grafana : Create Grafana directory] **************************************
ok: [cheburara-3]

TASK [grafana : Grafana configuration] *****************************************
ok: [cheburara-3]

TASK [grafana : Install Grafana in Docker container] ***************************
[DEPRECATION WARNING]: The container_default_behavior option will change its 
default value from "compatibility" to "no_defaults" in community.docker 2.0.0. 
To remove this warning, please specify an explicit value for it now. This 
feature will be removed from community.docker in version 2.0.0. Deprecation 
warnings can be disabled by setting deprecation_warnings=False in ansible.cfg.
ok: [cheburara-3]

TASK [grafana : Create Grafana directories] ************************************
ok: [cheburara-3] => (item=/opt/grafana/provisioning/dashboards)
ok: [cheburara-3] => (item=/opt/grafana/provisioning/datasources)

TASK [grafana : Copy dashboard configurations] *********************************
ok: [cheburara-3] => (item={'src': 'dashboard-source.yaml', 'dest': '/opt/grafana/provisioning/dashboards/dashboard-source.yaml'})
ok: [cheburara-3] => (item={'src': 'datasource.yaml', 'dest': '/opt/grafana/provisioning/datasources/datasource.yaml'})
ok: [cheburara-3] => (item={'src': 'main.json', 'dest': '/opt/grafana/provisioning/dashboards/main.json'})
ok: [cheburara-3] => (item={'src': 'syslog.json', 'dest': '/opt/grafana/provisioning/dashboards/syslog.json'})
ok: [cheburara-3] => (item={'src': 'mysql.json', 'dest': '/opt/grafana/provisioning/dashboards/mysql.json'})
ok: [cheburara-3] => (item={'src': 'haproxy_keepalived.json', 'dest': '/opt/grafana/provisioning/dashboards/haproxy_keepalived.json'})
ok: [cheburara-3] => (item={'src': 'status.json', 'dest': '/opt/grafana/provisioning/dashboards/status.json'})

PLAY [InfluxDB] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [influxdb : Create destination directory] *********************************
ok: [cheburara-3]

TASK [influxdb : Download InfluxDB 1.8.10 package] *****************************
ok: [cheburara-3]

TASK [influxdb : Install InfluxDB] *********************************************
ok: [cheburara-3]

TASK [influxdb : Copy InfluxDB configuration file] *****************************
ok: [cheburara-3]

TASK [influxdb : Start InfluxDB service] ***************************************
ok: [cheburara-3]

TASK [influxdb : Add InfluxData GPG key] ***************************************
ok: [cheburara-3]

TASK [influxdb : Download Telegraf package] ************************************
ok: [cheburara-3]

TASK [influxdb : Install Telegraf] *********************************************
ok: [cheburara-3]

TASK [influxdb : Reconfigure Telegraf] *****************************************
ok: [cheburara-3]

TASK [influxdb : Start service telegraf] ***************************************
ok: [cheburara-3]

TASK [influxdb : Include Exporter Tasks] ***************************************
included: /home/cheba/ica0002/roles/influxdb/tasks/exporters/main.yaml for cheburara-3

TASK [influxdb : Get the latest release URL for InfluxDB Stats Exporter] *******
ok: [cheburara-3]

TASK [influxdb : Download InfluxDB Stats Exporter binary] **********************
ok: [cheburara-3]

TASK [influxdb : Create systemd service for InfluxDB Stats Exporter] ***********
ok: [cheburara-3]

TASK [influxdb : Enable and start InfluxDB Stats Exporter] *********************
ok: [cheburara-3]

TASK [influxdb : Ensure /home/backup/influxdb directory exists] ****************
ok: [cheburara-3]

TASK [influxdb : Create Cron tab file for InfluxDB backup] *********************
ok: [cheburara-3]

PLAY [Pinger] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [pinger : Install fping] **************************************************
ok: [cheburara-3]

TASK [pinger : Install curl] ***************************************************
ok: [cheburara-3]

TASK [pinger : Add the user "pinger"] ******************************************
ok: [cheburara-3]

TASK [pinger : Copy pinger.sh to /usr/local/bin/pinger] ************************
ok: [cheburara-3]

TASK [pinger : Create the /etc/pinger directory] *******************************
ok: [cheburara-3]

TASK [pinger : Copy pinger.conf to /etc/pinger/pinger.conf] ********************
ok: [cheburara-3]

TASK [pinger : Copy the pinger.service unit file] ******************************
ok: [cheburara-3]

TASK [pinger : Start and enable the pinger service] ****************************
ok: [cheburara-3]

PLAY [HAPoxy] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [haproxy : Installation HAProxy] ******************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : HAProxy Configuration] *****************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : Ensure HAProxy is enabled] *************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : HAProxy exporters] *********************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : Configure prometheus-haproxy-exporter] *************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : Ensure HAProxy exporter is enabled] ****************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Installation of Keepalived] *********************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Create keepalived_script user] ******************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Create home directory for keepalived_script user] ***********
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Create configuration for keepalived_script] *****************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Keepalived configuration] ***********************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Enable keepalived] ******************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Ensure /usr/local/bin directory exists] *********************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Download Keepalived Exporter Binary] ************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Extract and Install Keepalived Exporter Binary] *************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Configuration of Keepalived Exporter] ***********************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Start and Enable Keepalived Exporter] ***********************
ok: [cheburara-1]
ok: [cheburara-2]

PLAY [Web Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [docker : Install Docker packages] ****************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [docker : Enable Docker service] ******************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [agama : Create Agama directory] ******************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [agama : Download AGAMA Application] **************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [agama : Download Dockerfile] *********************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [agama : Build Docker image for Agama] ************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [agama : Start Agama containers] ******************************************
ok: [cheburara-2] => (item=None)
ok: [cheburara-1] => (item=None)
ok: [cheburara-2] => (item=None)
ok: [cheburara-2]
ok: [cheburara-1] => (item=None)
ok: [cheburara-1]

TASK [nginx : Install Nginx] ***************************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [nginx : Copy custom Nginx default configuration] *************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [nginx : Start Nginx and enable it at boot] *******************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [nginx : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/nginx/tasks/exporters/main.yaml for cheburara-1, cheburara-2

TASK [nginx : Install Nginx exporter from Ubuntu package repository] ***********
ok: [cheburara-1]
ok: [cheburara-2]

TASK [nginx : Enable exporter service] *****************************************
ok: [cheburara-2]
ok: [cheburara-1]

PLAY RECAP *********************************************************************
cheburara-1                : ok=76   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
cheburara-2                : ok=76   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
cheburara-3                : ok=74   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

cheburara-3 | FAILED! => {
    "msg": "Timeout (12s) waiting for privilege escalation prompt: "
}
cheburara-2 | CHANGED => {
    "changed": true,
    "elapsed": 42,
    "rebooted": true
}
cheburara-1 | CHANGED => {
    "changed": true,
    "elapsed": 46,
    "rebooted": true
}
[WARNING]: Collection community.general does not support Ansible version 2.10.8

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Update APT cache] *************************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Install Prometheus Node Exporter] *********************************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Start and Enable Node Exporter Service] ***************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Install up-to-date CA certificates] *******************************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Install rsyslog] **************************************************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Create a custom rsyslog configuration file] ***********************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Modify a custom rsyslog configuration file] ***********************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Ensure the user 'backup' exists with a unique SSH key] ************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [init : Create known_hosts file for user backup] **************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Ensure /home/backup/restore directory exists] *********************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [init : Ensure Duplicity is installed] ************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

PLAY [DNS server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-1]
ok: [cheburara-3]
ok: [cheburara-2]

TASK [bind : Install Bind9 package] ********************************************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [bind : Create configuration bind9 file] **********************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Create configuration bind9 for master and slave] ******************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Create DNS Zone File if not existing] *****************************
ok: [cheburara-1]
ok: [cheburara-3]
ok: [cheburara-2]

TASK [bind : Create DNS Reverse Zone File if not existing] *********************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Ensure bind9 service is started and enabled] **********************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [bind : Add A record for backup server using nsupdate] ********************
skipping: [cheburara-1]
skipping: [cheburara-2]
ok: [cheburara-3]

TASK [bind : Add CNAME record] *************************************************
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-1] => (item=None) 
skipping: [cheburara-1]
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2] => (item=None) 
skipping: [cheburara-2]
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3] => (item=None)
ok: [cheburara-3]

TASK [bind : Add A record for backup server using nsupdate for reverse zone] ***
skipping: [cheburara-1]
skipping: [cheburara-2]
ok: [cheburara-3]

TASK [bind : Include Exporter Tasks] *******************************************
included: /home/cheba/ica0002/roles/bind/tasks/exporters/main.yaml for cheburara-3, cheburara-1, cheburara-2

TASK [bind : Install Bind9 exporter from Ubuntu package repository] ************
ok: [cheburara-1]
ok: [cheburara-2]
ok: [cheburara-3]

TASK [bind : Enable Bind9 exporter] ********************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

PLAY [Resolver] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

TASK [resolver : Configure /etc/resolv.conf] ***********************************
ok: [cheburara-2]
ok: [cheburara-1]
ok: [cheburara-3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : Install MySQL Server package] ************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : Install PyMySQL package] *****************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : Create override.cnf file] ****************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure mysql service is started and enabled] *********************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : MySQL database] **************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : MySQL user] ******************************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/mysql/tasks/exporters/main.yaml for cheburara-1, cheburara-2

TASK [mysql : Install MySQL Exporter from Ubuntu Repository] *******************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL 'exporter' User] ************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create ~/.my.cnf for Exporter User] ******************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : Update Prometheus MySQL Exporter for Replication Metrics] ********
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure Exporter Restarts] ****************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Ensure mysql service is started and enabled] *********************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [mysql : Ensure /home/backup/mysql directory exists] **********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL user 'backup' with privileges] **********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL client configuration file for user 'backup'] ********
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create Cron file] ************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : Create MySQL user 'replication' with privileges] *****************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [mysql : MySQL read only mode configuration] ******************************
ok: [cheburara-2]
ok: [cheburara-1]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [nginx : Install Nginx] ***************************************************
ok: [cheburara-3]

TASK [nginx : Copy custom Nginx default configuration] *************************
ok: [cheburara-3]

TASK [nginx : Start Nginx and enable it at boot] *******************************
ok: [cheburara-3]

TASK [nginx : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/nginx/tasks/exporters/main.yaml for cheburara-3

TASK [nginx : Install Nginx exporter from Ubuntu package repository] ***********
ok: [cheburara-3]

TASK [nginx : Enable exporter service] *****************************************
ok: [cheburara-3]

TASK [prometheus : Install Prometheus] *****************************************
ok: [cheburara-3]

TASK [prometheus : Create Prometheus Configuration Directory] ******************
ok: [cheburara-3]

TASK [prometheus : Configure Prometheus] ***************************************
ok: [cheburara-3]

TASK [prometheus : Configure Prometheus] ***************************************
ok: [cheburara-3]

TASK [prometheus : Start and Enable Prometheus Service] ************************
ok: [cheburara-3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [docker : Install Docker packages] ****************************************
ok: [cheburara-3]

TASK [docker : Enable Docker service] ******************************************
ok: [cheburara-3]

TASK [grafana : Create Grafana directory] **************************************
ok: [cheburara-3]

TASK [grafana : Grafana configuration] *****************************************
ok: [cheburara-3]

TASK [grafana : Install Grafana in Docker container] ***************************
[DEPRECATION WARNING]: The container_default_behavior option will change its 
default value from "compatibility" to "no_defaults" in community.docker 2.0.0. 
To remove this warning, please specify an explicit value for it now. This 
feature will be removed from community.docker in version 2.0.0. Deprecation 
warnings can be disabled by setting deprecation_warnings=False in ansible.cfg.
ok: [cheburara-3]

TASK [grafana : Create Grafana directories] ************************************
ok: [cheburara-3] => (item=/opt/grafana/provisioning/dashboards)
ok: [cheburara-3] => (item=/opt/grafana/provisioning/datasources)

TASK [grafana : Copy dashboard configurations] *********************************
ok: [cheburara-3] => (item={'src': 'dashboard-source.yaml', 'dest': '/opt/grafana/provisioning/dashboards/dashboard-source.yaml'})
ok: [cheburara-3] => (item={'src': 'datasource.yaml', 'dest': '/opt/grafana/provisioning/datasources/datasource.yaml'})
ok: [cheburara-3] => (item={'src': 'main.json', 'dest': '/opt/grafana/provisioning/dashboards/main.json'})
ok: [cheburara-3] => (item={'src': 'syslog.json', 'dest': '/opt/grafana/provisioning/dashboards/syslog.json'})
ok: [cheburara-3] => (item={'src': 'mysql.json', 'dest': '/opt/grafana/provisioning/dashboards/mysql.json'})
ok: [cheburara-3] => (item={'src': 'haproxy_keepalived.json', 'dest': '/opt/grafana/provisioning/dashboards/haproxy_keepalived.json'})
ok: [cheburara-3] => (item={'src': 'status.json', 'dest': '/opt/grafana/provisioning/dashboards/status.json'})

PLAY [InfluxDB] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [influxdb : Create destination directory] *********************************
ok: [cheburara-3]

TASK [influxdb : Download InfluxDB 1.8.10 package] *****************************
ok: [cheburara-3]

TASK [influxdb : Install InfluxDB] *********************************************
ok: [cheburara-3]

TASK [influxdb : Copy InfluxDB configuration file] *****************************
ok: [cheburara-3]

TASK [influxdb : Start InfluxDB service] ***************************************
ok: [cheburara-3]

TASK [influxdb : Add InfluxData GPG key] ***************************************
ok: [cheburara-3]

TASK [influxdb : Download Telegraf package] ************************************
ok: [cheburara-3]

TASK [influxdb : Install Telegraf] *********************************************
ok: [cheburara-3]

TASK [influxdb : Reconfigure Telegraf] *****************************************
ok: [cheburara-3]

TASK [influxdb : Start service telegraf] ***************************************
ok: [cheburara-3]

TASK [influxdb : Include Exporter Tasks] ***************************************
included: /home/cheba/ica0002/roles/influxdb/tasks/exporters/main.yaml for cheburara-3

TASK [influxdb : Get the latest release URL for InfluxDB Stats Exporter] *******
ok: [cheburara-3]

TASK [influxdb : Download InfluxDB Stats Exporter binary] **********************
ok: [cheburara-3]

TASK [influxdb : Create systemd service for InfluxDB Stats Exporter] ***********
ok: [cheburara-3]

TASK [influxdb : Enable and start InfluxDB Stats Exporter] *********************
ok: [cheburara-3]

TASK [influxdb : Ensure /home/backup/influxdb directory exists] ****************
ok: [cheburara-3]

TASK [influxdb : Create Cron tab file for InfluxDB backup] *********************
ok: [cheburara-3]

PLAY [Pinger] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-3]

TASK [pinger : Install fping] **************************************************
ok: [cheburara-3]

TASK [pinger : Install curl] ***************************************************
ok: [cheburara-3]

TASK [pinger : Add the user "pinger"] ******************************************
ok: [cheburara-3]

TASK [pinger : Copy pinger.sh to /usr/local/bin/pinger] ************************
ok: [cheburara-3]

TASK [pinger : Create the /etc/pinger directory] *******************************
ok: [cheburara-3]

TASK [pinger : Copy pinger.conf to /etc/pinger/pinger.conf] ********************
ok: [cheburara-3]

TASK [pinger : Copy the pinger.service unit file] ******************************
ok: [cheburara-3]

TASK [pinger : Start and enable the pinger service] ****************************
ok: [cheburara-3]

PLAY [HAPoxy] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : Installation HAProxy] ******************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [haproxy : HAProxy Configuration] *****************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [haproxy : Ensure HAProxy is enabled] *************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [haproxy : HAProxy exporters] *********************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [haproxy : Configure prometheus-haproxy-exporter] *************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [haproxy : Ensure HAProxy exporter is enabled] ****************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Installation of Keepalived] *********************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Create keepalived_script user] ******************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Create home directory for keepalived_script user] ***********
ok: [cheburara-1]
ok: [cheburara-2]

TASK [keepalived : Create configuration for keepalived_script] *****************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Keepalived configuration] ***********************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Enable keepalived] ******************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Ensure /usr/local/bin directory exists] *********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Download Keepalived Exporter Binary] ************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Extract and Install Keepalived Exporter Binary] *************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Configuration of Keepalived Exporter] ***********************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [keepalived : Start and Enable Keepalived Exporter] ***********************
ok: [cheburara-2]
ok: [cheburara-1]

PLAY [Web Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [docker : Install Docker packages] ****************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [docker : Enable Docker service] ******************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [agama : Create Agama directory] ******************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [agama : Download AGAMA Application] **************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [agama : Download Dockerfile] *********************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [agama : Build Docker image for Agama] ************************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [agama : Start Agama containers] ******************************************
ok: [cheburara-2] => (item=None)
ok: [cheburara-1] => (item=None)
ok: [cheburara-1] => (item=None)
ok: [cheburara-1]
ok: [cheburara-2] => (item=None)
ok: [cheburara-2]

TASK [nginx : Install Nginx] ***************************************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [nginx : Copy custom Nginx default configuration] *************************
ok: [cheburara-1]
ok: [cheburara-2]

TASK [nginx : Start Nginx and enable it at boot] *******************************
ok: [cheburara-2]
ok: [cheburara-1]

TASK [nginx : Include Exporter Tasks] ******************************************
included: /home/cheba/ica0002/roles/nginx/tasks/exporters/main.yaml for cheburara-1, cheburara-2

TASK [nginx : Install Nginx exporter from Ubuntu package repository] ***********
ok: [cheburara-1]
ok: [cheburara-2]

TASK [nginx : Enable exporter service] *****************************************
ok: [cheburara-1]
ok: [cheburara-2]

PLAY RECAP *********************************************************************
cheburara-1                : ok=76   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
cheburara-2                : ok=76   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
cheburara-3                : ok=74   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

K 20 dets  2023 13:01:08 EET
